# NewPlayerPanel v3.0.0

## Возможности

### Модуль отслеживания жителей

Модуль отслеживания жителей предоставляет комплексный мониторинг и логирование событий смерти жителей:

- **Запись событий смерти**: Автоматически отслеживает все смерти жителей с полными метаданными
- **Идентификация убийцы**: Записывает имя игрока, UUID и связанную информацию
- **Отслеживание местоположения**: Сохраняет точные координаты (X, Y, Z) и название мира для каждого события
- **Определение типа жителя**: Определяет и записывает конкретный тип жителя
- **Сохранение зачарований**: Захватывает данные о зачарованиях из торговли с жителями
- **Интерактивные координаты**: Кликабельные ссылки на координаты для мгновенной телепортации
- **Расширенный поиск**: Запрос записей по имени игрока, координатам или комбинированным критериям
- **Система уведомлений**: Уведомления в реальном времени для администраторов с соответствующими разрешениями
- **Очистка данных**: Автоматическая очистка исторических записей на основе временных критериев

### Система ограничений игроков

Продвинутая система ограничений, позволяющая точный контроль над действиями игроков:

- **Множественные типы ограничений**: Поддержка ограничений EQUIPMENT, ITEM, ENTITY и COMMAND
- **Ограничения по умолчанию**: Автоматическое применение ограничений на основе времени игрока на сервере
- **Временной контроль**: Настройка временных или постоянных ограничений
- **Управление в игре**: Создание и изменение ограничений через командный интерфейс
- **Детализация действий**: Точная настройка ограничений с использованием типов действий (DAMAGE, USE, DROP, EQUIP, EXECUTE)
- **Персональные переопределения**: Применение индивидуальных ограничений, которые переопределяют настройки по умолчанию
- **Применение в реальном времени**: Ограничения проверяются и применяются каждые 0.1 секунды
- **Просмотр игроками**: Игроки могут просматривать свои активные ограничения с помощью `/restrictions`
- **Временные ограничения по умолчанию**: Ограничения по умолчанию считают время с первого входа игрока, а не с запуска сервера

### Системы хранения

Несколько бэкендов хранения для максимальной гибкости:

- **Хранение YAML/JSON**: Файловое хранение с использованием формата JSON в директории данных плагина
- **База данных H2**: Легковесная встроенная база данных SQLite (по умолчанию, не требует настройки)
- **Поддержка MySQL**: Полная интеграция с базой данных MySQL с пулом соединений
- **Поддержка MariaDB**: Нативная поддержка базы данных MariaDB с оптимизированными запросами

### Локализация

Полная поддержка интернационализации:

- **Многоязычность**: Полная поддержка русского и английского языков включена
- **Расширяемость**: Легко добавить дополнительные языки через файлы сообщений
- **Настраиваемые сообщения**: Весь пользовательский текст может быть изменен через конфигурацию
- **Переключение языка в реальном времени**: Изменение языка без перезапуска сервера

---

## Команды

### Административные команды

| Команда | Описание | Разрешение | Пример использования |
|---------|----------|------------|---------------------|
| `/npp reload` | Перезагружает конфигурацию плагина и применяет изменения | `newplayerpanel.admin` | `/npp reload` |
| `/npp addrestriction` | Создает новое определение ограничения | `newplayerpanel.admin` | `/npp addrestriction elytra_ban EQUIPMENT EQUIP minecraft:elytra time:-1 default:false` |

**Синтаксис команды:**
```
/npp addrestriction <name> <type> <actions> [targets...] [time:N] [default:true/false]
```

### Команды истории

| Команда | Описание | Разрешение | Пример использования |
|---------|----------|------------|---------------------|
| `/history` | Отображает все записи о смертях жителей | `newplayerpanel.history` | `/history` |
| `/history <player>` | Показывает записи для конкретного игрока | `newplayerpanel.history` | `/history Steve` |
| `/history <x> <y> <z>` | Показывает записи рядом с координатами | `newplayerpanel.history` | `/history 100 64 200` |
| `/history coords` | Показывает записи в вашем текущем местоположении | `newplayerpanel.history` | `/history coords` |
| `/history purge <time>` | Удаляет записи старше указанного времени | `newplayerpanel.history.purge` | `/history purge 7d` |

**Примеры формата времени:**
- `7d` - 7 дней
- `30d` - 30 дней
- `1h` - 1 час
- `2w` - 2 недели
- `1M` - 1 месяц

### Команды управления ограничениями

| Команда | Описание | Разрешение | Пример использования |
|---------|----------|------------|---------------------|
| `/restrict <player> <restriction> <time>` | Применяет ограничение к игроку | `newplayerpanel.restrictions.restrict` | `/restrict Steve elytra_ban 3600` |
| `/unrestrict <player> <restriction\|all>` | Удаляет ограничение(я) у игрока | `newplayerpanel.restrictions.restrict` | `/unrestrict Steve elytra_ban` |
| `/restrictions` | Отображает ваши активные ограничения | `newplayerpanel.restrictions.view` | `/restrictions` |
| `/restrictions [player]` | Отображает активные ограничения игрока | `newplayerpanel.restrictions.view.others` | `/restrictions Steve` |

**Значения времени:**
- `-1` - Постоянное ограничение
- `0` - Удалить ограничение
- `>0` - Длительность в секундах (например, `3600` = 1 час)

**Примечание:** Игроки могут просматривать свои ограничения, используя `/restrictions` без аргументов. Администраторы могут просматривать ограничения других игроков, указав имя игрока.

---

## Разрешения

| Узел разрешения | Описание | Доступ по умолчанию |
|----------------|----------|---------------------|
| `newplayerpanel.admin` | Полный административный доступ к командам `/npp` | Только операторы |
| `newplayerpanel.history` | Просмотр записей истории смертей жителей | Только операторы |
| `newplayerpanel.history.purge` | Разрешение на очистку старых записей истории | Только операторы |
| `newplayerpanel.notify` | Получение уведомлений о смертях жителей | Только операторы |
| `newplayerpanel.restrictions.bypass` | Обход всех ограничений из конфигурации | Только операторы |
| `newplayerpanel.restrictions.restrict` | Применение и удаление ограничений игроков | Только операторы |
| `newplayerpanel.restrictions.view` | Просмотр ваших активных ограничений | Все игроки |
| `newplayerpanel.restrictions.view.others` | Просмотр ограничений других игроков | Только операторы |

---

## Конфигурация

### Основной файл конфигурации (`config.yml`)

```yaml
language: ru
storage: H2
database:
  host: localhost
  port: 3306
  database: newplayerpanel
  username: root
  password: ""
  pool:
    maximum-pool-size: 10
    minimum-idle: 2
    connection-timeout: 30000
    idle-timeout: 600000
    max-lifetime: 1800000

villager-tracker:
  only-traded: true
  notify-enabled: true
  save-debug-files: false
```

### Файл конфигурации ограничений (`restrictions.yml`)

```yaml
restrictions:
  - name: elytra_ban
    type: EQUIPMENT
    actions: EQUIP
    item: [minecraft:elytra]
    time: -1
    default: false
    
  - name: tnt_restriction
    type: ITEM
    actions: USE
    item: [minecraft:tnt]
    time: 28800
    default: true
    
  - name: villager_hit_restriction
    type: ENTITY
    actions: DAMAGE
    entity: [minecraft:villager]
    time: -1
    default: false
```

### Типы ограничений

| Тип | Описание | Поле цели |
|------|----------|-----------|
| `EQUIPMENT` | Ограничивает экипировку предметов в слотах брони/элитр | `item` |
| `ITEM` | Ограничивает использование или размещение предметов | `item` |
| `ENTITY` | Ограничивает взаимодействие с сущностями | `entity` |
| `COMMAND` | Ограничивает выполнение команд | `command` |

### Типы действий

| Действие | Описание |
|----------|----------|
| `DAMAGE` | Нанесение урона сущностям |
| `USE` | Использование или размещение предметов |
| `DROP` | Выбрасывание предметов |
| `EQUIP` | Экипировка предметов в слотах брони/элитр |
| `EXECUTE` | Выполнение команд |

### Логика ограничений

**Ограничения по умолчанию:**
- Когда `default: true`, ограничения применяются автоматически ко всем игрокам
- Время рассчитывается от **первого входа игрока** (не от времени запуска сервера)
- Пример: Если `time: 3600` (1 час), ограничение применяется в течение первого часа после первого входа игрока
- Если `time: -1`, ограничение постоянно для всех игроков
- Ограничения по умолчанию автоматически удаляются при истечении времени

**Персональные ограничения:**
- Применяются через команду `/restrict`
- Время рассчитывается от **момента применения** (не от первого входа игрока)
- Персональные ограничения **переопределяют** ограничения по умолчанию
- Если у игрока есть персональное ограничение, ограничения по умолчанию с тем же именем игнорируются
- Персональные ограничения могут быть удалены вручную с помощью `/unrestrict`

**Порядок приоритета:**
1. Персональные ограничения (наивысший приоритет)
2. Ограничения по умолчанию (если персонального ограничения нет)

**Просмотр ограничений:**
- Игроки могут просматривать свои ограничения: `/restrictions`
- Администраторы могут просматривать ограничения любого игрока: `/restrictions <player>`
- Отображаются как персональные, так и ограничения по умолчанию с оставшимся временем

---

## Системы хранения

### Хранение YAML/JSON

Файловое хранение с использованием формата JSON. Все данные хранятся в `plugins/NewPlayerPanel/data/`:
- `messages.json` - Сообщения локализации
- `villager_deaths.json` - Записи о смертях жителей
- `restrictions.json` - Данные об ограничениях игроков

**Преимущества:**
- Не требуется настройка базы данных
- Легко создавать резервные копии (копировать файлы)
- Читаемый формат

**Конфигурация:**
```yaml
storage: YAML
```

### База данных H2 (По умолчанию)

Встроенная база данных SQLite, хранящаяся как `plugins/NewPlayerPanel/database.db`.

**Преимущества:**
- Нет внешних зависимостей
- Автоматическая настройка
- Хорошая производительность для малых и средних серверов

**Конфигурация:**
```yaml
storage: H2
```

### База данных MySQL

Полная интеграция с базой данных MySQL с пулом соединений через HikariCP.

**Преимущества:**
- Масштабируемость для больших серверов
- Поддержка нескольких экземпляров сервера
- Расширенные возможности запросов

**Конфигурация:**
```yaml
storage: MYSQL
database:
  host: localhost
  port: 3306
  database: newplayerpanel
  username: root
  password: your_password
```

### База данных MariaDB

Нативная поддержка MariaDB с оптимизированной обработкой соединений.

**Преимущества:**
- Совместимость с функциями MariaDB
- Высокая производительность
- Надежность корпоративного уровня
- Оптимизированное подключение с правильными параметрами
- Автоматическая проверка и добавление колонок для обратной совместимости

**Конфигурация:**
```yaml
storage: MARIADB
database:
  host: localhost
  port: 3306
  database: newplayerpanel
  username: root
  password: your_password
  pool:
    maximum-pool-size: 10
    minimum-idle: 2
    connection-timeout: 30000
    idle-timeout: 600000
    max-lifetime: 1800000
```

## Совместимость

### Поддерживаемое серверное ПО

- **Spigot** - Полная совместимость
- **Purpur** - Полная совместимость
- **Любой сервер на основе Bukkit** - Совместим со стандартным API Bukkit

### Версии Minecraft

- **1.21.x** - Полностью поддерживается
- Будущие версии - Должны работать с API версии 1.20+

### Требования к Java

- **Java 17** - Минимальная требуемая версия
- **Java 21** - Рекомендуется для оптимальной производительности

### Требования к базе данных (если используется MySQL/MariaDB)

- **MySQL 8.0+**
- **MariaDB 10.3+**
- База данных должна поддерживать кодировку UTF-8

---

## Поддержка и документация

- **Автор:** Math_Tereegor
- **Помощь и поддержка:** MISQZY и 6oJIeH
- **Версия плагина:** 3.0.0
